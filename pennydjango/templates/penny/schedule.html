{% extends 'ui/base.html' %}
{% load static %}
{% load humanize %}
{% load bootstrap4 %}

{% bootstrap_messages %}

{% block inner %}
  <div class="row main-content-row">

      <br/>
      <div class="row">
        {% for obj in object_list %}
          <div class=" col-md-4 ">

              <div class="card card-smallcard-post card-post--1">
                <div class="card-post__image text-center">
                  <div id="map_{{ obj.id }}" style="height: 200px; width: 100%;"></div>
                  <a href="{% url 'schedule-delete' pk=obj.pk %}"
                     class="card-post__category badge badge-pill badge-dark">
                        <font size="4em"><i class="material-icons">delete_outline</i></font>
                     </a>
                </div>
                <div class="card-body p-0 pb-3 text-center"
                     style="{% if obj.is_active %}background-color: lightgreen{% endif %}">
                  <table class="table mb-0">
                    <tbody>
                    <tr>
                      <td><i class="material-icons">explore</i>
                        {{ obj.reference_property.address }}
                      </td>
                    </tr>
                    <tr>
                      <td><i class="material-icons">work</i>
                        Duty time: {{ obj.available_time }}
                      </td>
                    </tr>
                    <tr>
                      <td><i class="material-icons">watch_later</i>
                        Starting: {{ obj.start_datetime|naturaltime }}
                      </td>
                    </tr>
                    <tr>
                      <td><i class="material-icons">access_time</i>
                        Until: {{ obj.end_datetime|naturaltime }}
                      </td>
                    </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <br/>

          </div>
        {% endfor %}

        <div class="col-md-4">
          <div class="card">
            <div class="card-body p-3 text-center">
              <h5 class="card-title">Create itinerary</h5>
              <form autocomplete="off" action="#" method="post">
                {% csrf_token %}
                {% bootstrap_form form %}
                {% buttons %}
                  <button type="submit" class="btn btn-primary">
                    Add
                  </button>
                {% endbuttons %}
              </form>
            </div>
          </div>
        </div>

      </div>


  </div>
{% endblock %}


{% block tail %}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.min.css" integrity="sha256-DOS9W6NR+NFe1fUhEE0PGKY/fubbUCnOfTje2JMDw3Y=" crossorigin="anonymous" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.full.min.js" integrity="sha256-FEqEelWI3WouFOo2VWP/uJfs1y8KJ++FLh2Lbqc8SJk=" crossorigin="anonymous"></script>
  <script>
    $(function () {
      $("#id_start_datetime").datetimepicker({
        format: 'd/m/Y H:i',
      });
      $("#id_end_datetime").datetimepicker({
        format: 'd/m/Y H:i',
      });
    });
  </script>

  <script>
    function initMaps() {
      var mapEl, center, radius, map, area;
      {% for obj in object_list %}
        mapEl = document.getElementById('map_{{ obj.id }}')

        center = {
          lat: {{ obj.reference_property.latitude }},
          lng: {{ obj.reference_property.longitude }}
        }
        radius = {{ obj.radius|stringformat:"d" }}

        map = new google.maps.Map(mapEl, {
          zoom: 12,
          center,
          disableDefaultUI: true,
          zoomControl: true,
        });

        area = new google.maps.Circle({
          strokeColor: '#FF0000',
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: '#FF0000',
          fillOpacity: 0.35,
          map,
          center,
          radius
        });

        map.fitBounds(area.getBounds())
      {% endfor %}
    }
  </script>
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key={{ api_key }}&callback=initMaps">
  </script>
{% endblock %}
